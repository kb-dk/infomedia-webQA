<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE Configure PUBLIC "-//Jetty//Configure//EN" "http://www.eclipse.org/jetty/configure_9_3.dtd">
<Configure id="Server" class="org.eclipse.jetty.server.Server">
   <!-- =========================================================== -->
   <!-- Configure rewrite handler                                   -->
   <!-- =========================================================== -->
   <Call name="insertHandler">
      <Arg>
         <New class="org.eclipse.jetty.rewrite.handler.RewriteHandler">
            <Set name="rewriteRequestURI">
               <Property name="jetty.rewrite.rewriteRequestURI" deprecated="rewrite.rewriteRequestURI" default="true" />
            </Set>
            <Set name="rewritePathInfo">
               <Property name="jetty.rewrite.rewritePathInfo" deprecated="rewrite.rewritePathInfo" default="false" />
            </Set>
            <Set name="originalPathAttribute">
               <Property name="jetty.rewrite.originalPathAttribute" deprecated="rewrite.originalPathAttribute" default="requestedPath" />
            </Set>
            <!-- Set DispatcherTypes  -->
            <Set name="dispatcherTypes">
               <Array type="javax.servlet.DispatcherType">
                  <Item>
                     <Call class="javax.servlet.DispatcherType" name="valueOf">
                        <Arg>REQUEST</Arg>
                     </Call>
                  </Item>
                  <Item>
                     <Call class="javax.servlet.DispatcherType" name="valueOf">
                        <Arg>ASYNC</Arg>
                     </Call>
                  </Item>
               </Array>
            </Set>
            <Get id="Rewrite" name="ruleContainer" />
            <!-- see rewrite-compactpath.xml for example how to add a rule -->
            <Call name="addRule">
               <Arg>
                  <New class="org.eclipse.jetty.rewrite.handler.RewriteRegexRule">
                      <!-- Exclude static -->
                     <Set name="regex">(.*/static/.*)</Set>
                     <Set name="replacement">$1</Set>
                      <Set name="terminating">true</Set>
                  </New>
               </Arg>
            </Call>
            <Call name="addRule">
               <Arg>
                  <New class="org.eclipse.jetty.rewrite.handler.RewriteRegexRule">
                      <!-- Exclude static -->
                     <Set name="regex">(.*/api/.*)</Set>
                     <Set name="replacement">$1</Set>
                      <Set name="terminating">true</Set>
                  </New>
               </Arg>
            </Call>
            <Call name="addRule">
               <Arg>
                  <New class="org.eclipse.jetty.rewrite.handler.RewriteRegexRule">
                      <!-- Exclude static -->
                     <Set name="regex">.*/bar.html</Set>
                     <Set name="replacement">/nonexisting_on_purpose</Set>
                      <Set name="terminating">true</Set>
                  </New>
               </Arg>
            </Call>
            <Call name="addRule">
               <Arg>
                  <New class="org.eclipse.jetty.rewrite.handler.RewriteRegexRule">
                      <!-- Exclude static -->
                     <Set name="regex">^.*$</Set>
                      <!-- TODO: Figure out how to avoid the infomedia-webqa/ below -->
                      <!-- TODO: Make the Vue app aware of infomedia-webqa when constructing URLs -->
                     <Set name="replacement">/infomedia-webqa/index.html</Set>
                  </New>
               </Arg>
            </Call>

         </New>
      </Arg>
   </Call>
</Configure>
